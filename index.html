<!DOCTYPE html>
<html lang="es" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turismo Piombino - DEBUG</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    <style>
        :root { --primary-color: #00796b; --whatsapp-color: #25D366; --whatsapp-hover-color: #1DAE56; }
        html { scroll-behavior: smooth; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
        .container { max-width: 1100px; }
        nav { position: sticky; top: 0; z-index: 1000; background-color: var(--pico-card-background-color); border-bottom: 1px solid var(--pico-card-border-color); padding: 0.5rem 1rem; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .servicios-grid, .evento-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 1.5rem; margin-top: 2rem; }
        .servicio-card, .evento-card { border: 1px solid var(--pico-muted-border-color); border-radius: var(--pico-border-radius); padding: 0; display: flex; flex-direction: column; overflow: hidden; transition: transform 0.2s, box-shadow 0.2s; }
        .card-contenido { padding: 1.5rem; flex-grow: 1; display: flex; flex-direction: column; text-align: center; }
        .card-contenido .icono { font-size: 2.5rem; color: var(--primary-color); margin-bottom: 1rem; }
        .card-contenido h5 { margin-bottom: 0.5rem; }
        .card-contenido p { color: var(--pico-secondary); margin-bottom: 1rem; flex-grow: 1; }
        .card-contenido a[role="button"], .card-contenido button { background-color: var(--primary-color); border-color: var(--primary-color); width: 100%; }
        .evento-card.agotado { opacity: 0.6; }
        .evento-card.agotado button { pointer-events: none; }
        footer { margin-top: 4rem; padding: 2rem 1rem; border-top: 1px solid var(--pico-muted-border-color); text-align: center; background-color: var(--pico-muted-background-color); }
        section { padding-top: 5rem; }
    </style>
</head>
<body>
    <nav class="container-fluid">
        <ul><li><strong><a href="#">Turismo Piombino</a></strong></li></ul>
        <ul><li><a href="#servicios">Servicios</a></li><li><a href="#disponibilidad">Disponibilidad</a></li></ul>
    </nav>
    <main class="container">
        <section id="servicios">
            <h2 style="text-align:center;">Nuestros Servicios</h2>
            <div class="servicios-grid">
                <article class="servicio-card"><div class="card-contenido"><div class="icono"><i class="fa-solid fa-ticket"></i></div><h5>Traslados a Eventos</h5><p>Recitales y festivales. Revisa la lista de próximos eventos y cotiza tu viaje.</p><a href="#seccion-eventos-detalles" role="button">Ver Eventos Disponibles</a></div></article>
                <article class="servicio-card"><div class="card-contenido"><div class="icono"><i class="fa-solid fa-martini-glass-citrus"></i></div><h5>Eventos Sociales</h5><p>Casamientos, cumpleaños y celebraciones.</p><button onclick="abrirModalCotizacion({ nombre: 'Evento Social' })">Cotizar</button></div></article>
                <article class="servicio-card"><div class="card-contenido"><div class="icono"><i class="fa-solid fa-briefcase"></i></div><h5>Eventos Corporativos</h5><p>Transporte para seminarios, jornadas y team building.</p><button onclick="abrirModalCotizacion({ nombre: 'Evento Corporativo' })">Cotizar</button></div></article>
                <article class="servicio-card"><div class="card-contenido"><div class="icono"><i class="fa-solid fa-plane-departure"></i></div><h5>Traslados Aeropuerto</h5><p>Viajes a Ezeiza y Aeroparque. Puntualidad y confort.</p><button onclick="abrirModalCotizacion({ nombre: 'Aeropuerto' })">Cotizar</button></div></article>
                <article class="servicio-card"><div class="card-contenido"><div class="icono"><i class="fa-solid fa-van-shuttle"></i></div><h5>Viajes Privados / Alquiler</h5><p>Alquiler de vehículos con chofer para el destino que necesites.</p><button onclick="abrirModalCotizacion({ nombre: 'Viaje Privado' })">Cotizar</button></div></article>
                <article class="servicio-card"><div class="card-contenido"><div class="icono"><i class="fa-solid fa-earth-americas"></i></div><h5>Larga Distancia</h5><p>Servicios de larga distancia. Consultá tu próximo destino.</p><button onclick="abrirModalCotizacion({ nombre: 'Larga Distancia' })">Cotizar</button></div></article>
            </div>
        </section>
        <hr>
        <section id="seccion-eventos-detalles">
            <h3>Próximos Eventos Disponibles</h3>
            <div id="eventos-lista" class="evento-grid"><p aria-busy="true">Cargando eventos disponibles...</p></div>
        </section>
        <hr>
        <section id="disponibilidad">
            <h2>Disponibilidad General</h2>
            <div class="calendar-container" style="position: relative; padding-bottom: 75%; height: 0; overflow: hidden; max-width: 100%;"><iframe src="https://calendar.google.com/calendar/embed?src=e7dc2c14d6465b8137e09d3128566ae23a25b3110fc57aee79302fa1990c1552%40group.calendar.google.com&ctz=America%2FArgentina%2FBuenos_Aires" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0;"></iframe></div>
        </section>
    </main>
    <footer id="contacto">
      <p><strong>Turismo Piombino © 2025</strong></p>
      <a href="https://www.instagram.com/turismo_piombino/" target="_blank" aria-label="Instagram"><i class="fa-brands fa-instagram"></i></a>
      <a href="https://www.facebook.com/leo.piombino" target="_blank" aria-label="Facebook"><i class="fa-brands fa-facebook"></i></a>
    </footer>
    <dialog id="modal-cotizacion"></dialog>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const googleSheetEventosUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTGqjcBT-GiILtXal_RQqsBrr7HypTsWgyJT8KgmIBa7YnhjyId1TLsDnj3f-1dMA5BF3Op5PF-wQdN/pub?output=csv';
    const listaEventosContainer = document.getElementById('eventos-lista');
    
    function csvToArray(csv) {
        const lines = csv.split(/\r?\n/);
        const headers = lines[0].split(',');
        const data = [];
        const regex = /,(?=(?:(?:[^"]*"){2})*[^"]*$)/;
        for (let i = 1; i < lines.length; i++) {
            if (!lines[i]) continue;
            const values = lines[i].split(regex);
            if (values.length === headers.length) {
                const obj = {};
                for (let j = 0; j < headers.length; j++) {
                    let value = values[j] || '';
                    if (value.startsWith('"') && value.endsWith('"')) { value = value.slice(1, -1); }
                    obj[headers[j].trim()] = value.trim();
                }
                data.push(obj);
            }
        }
        return data;
    }
    
    async function fetchAndRenderEvents() {
        console.log("Paso 1: Iniciando la función para cargar eventos...");
        if (!listaEventosContainer) {
            console.error("Error Crítico: No se encontró el contenedor de eventos #eventos-lista.");
            return;
        }

        try {
            console.log("Paso 2: Intentando hacer 'fetch' a la URL de Google Sheets...");
            console.log("URL:", googleSheetEventosUrl);
            
            const response = await fetch(googleSheetEventosUrl, { cache: 'no-store' });
            
            console.log("Paso 3: Respuesta recibida del servidor. Estado de la respuesta:", response.status);
            if (!response.ok) {
                throw new Error(`Error de red: ${response.status} - ${response.statusText}`);
            }
            
            const csvText = await response.text();
            console.log("Paso 4: Texto CSV recibido (primeros 300 caracteres):", csvText.substring(0, 300));
            
            if (csvText.trim() === '') {
                console.warn("Advertencia: El archivo CSV está vacío.");
                listaEventosContainer.innerHTML = '<p>No hay eventos programados por el momento (planilla vacía).</p>';
                return;
            }

            const eventos = csvToArray(csvText);
            console.log("Paso 5: El texto CSV ha sido procesado. Cantidad de eventos encontrados:", eventos.length);
            console.log("Datos procesados:", eventos);

            listaEventosContainer.innerHTML = ''; 
            if (eventos.length === 0) {
                 listaEventosContainer.innerHTML = '<p>No hay eventos programados por el momento (después de procesar).</p>';
                 return;
            }
            
            console.log("Paso 6: Construyendo las tarjetas de eventos...");
            eventos.forEach(evento => {
                if (!evento.id || !evento.nombre) return;
                const esAgotado = evento.estado === 'agotado';
                const tarjeta = document.createElement('article');
                tarjeta.className = `evento-card ${esAgotado ? 'agotado' : ''}`;
                tarjeta.innerHTML = `<div class="card-contenido"><h5>${evento.nombre}</h5><p><i class="fa-regular fa-calendar"></i> ${evento.fecha}<br><i class="fa-solid fa-location-dot"></i> ${evento.lugar}</p><button onclick='abrirModalCotizacion(${JSON.stringify(evento)})' ${esAgotado ? 'disabled' : ''}>${esAgotado ? 'Cupos Agotados' : 'Cotizar Traslado'}</button></div>`;
                listaEventosContainer.appendChild(tarjeta);
            });
            console.log("Paso 7: ¡Proceso completado con éxito!");

        } catch (error) {
            console.error("ERROR FINAL: La función falló en el bloque 'catch'. El error detallado es:", error);
            listaEventosContainer.innerHTML = `<p>Hubo un error al cargar los eventos. Revisa la Consola (F12) para más detalles.</p>`;
        }
    }

    // El resto de las funciones (abrirModalCotizacion, etc.) no las incluimos aquí para mantener
    // la prueba enfocada solo en la carga de eventos.
    window.abrirModalCotizacion = function(evento) { alert(`El botón para "${evento.nombre}" funciona, pero el formulario está desactivado en esta prueba.`); }

    fetchAndRenderEvents();
});
</script>
</body>
</html>
